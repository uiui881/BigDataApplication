use team06;

create table age ( 
    age_id int,
    age varchar(10) not null,
    PRIMARY KEY(age_id)
);

create table company( 
	company_id int,
	company_name varchar(30) not null,
	PRIMARY KEY(company_id)
);
create table brand(
    brand_id int,
    brand_name varchar(50) not null,
    company_id int,  
    PRIMARY KEY(brand_id),
    FOREIGN KEY(company_id) REFERENCES company(company_id) on DELETE CASCADE
);

create table sex(
     sex_id int,
     sex_name varchar(10) not null,
     PRIMARY KEY(sex_id)
);


create table stability(
        company_id int,
        yr int, 
        capital double, 
        debt double, 
        dept_ratio int ,
        equity_capital_ratio int,
        violation_of_the_law int,
        PRIMARY KEY(company_id, yr)
);




create table profitability(
        company_id int,
        yr int, 
        asset int,
        sales int, 
        operatingprofit int,
        totalassetgrowthrate float, 
        salesgrowthrate float, 
        operatingprofitgrowthrate varchar(10) not null,
        PRIMARY KEY(company_id, yr)
);


create table current_situation(
        brand_id int,
        opening_date Date not null,
        NumberOfFranchises int,
        NumberOfEmployees int not null,
        Scheduled_To_Open int,
        Scheduled_To_Close int,
        Contract_Termination int,
        Transfer int,
        AverageSales int,
        Average_Sales_per_Area int,
        PRIMARY KEY(brand_id)
        
);

create table opening_cost( 
        brand_id int,
        subscript_fee int,
        education_fee int,
        deposit_fee int,
        extra_fee int,
        cost_per_area int,
        standard_area float,
        PRIMARY KEY(brand_id)
);


create table customer(
        customer_id int,
        sex_id int,
        age_id int,
        nickname  varchar(30) not null,
        password varchar(30) not null,
        PRIMARY KEY(customer_id),
        FOREIGN KEY(sex_id) REFERENCES sex(sex_id) on DELETE CASCADE,
        FOREIGN KEY(age_id) REFERENCES age(age_id) on DELETE CASCADE
);

create table rate(
        customer_id int,
        brand_id int,
        staff_service int, 
        accessibility int,
        convenience int,
        taste_menu int,
        price int,
        additional_service int,
        service_favorability int,
        PRIMARY KEY(customer_id,brand_id),
        FOREIGN KEY(customer_id) REFERENCES customer(customer_id) on DELETE CASCADE,
 FOREIGN KEY(brand_id) REFERENCES brand(brand_id) on DELETE CASCADE	
);
        
create view franchisesNumSum as
select brand.company_id, sum(current_situation.NumberOfFranchises), ntile(5) over(order by sum(current_situation.NumberOfFranchises) asc)
FROM brand, current_situation where brand.brand_id = current_situation.brand_id 
group by brand.company_id
order by brand.company_id;
	
create index customer_nickname_index on customer(nickname);
